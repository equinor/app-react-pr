name: ðŸ§ª Lint Validation

permissions:
  contents: read
  pull-requests: write
  checks: write

on:
  workflow_call:
    inputs:
      NODE_VERSION:
        required: false
        type: string
        default: '22'
jobs:
  lint:
    name: ðŸ§ª Lint Validation
    runs-on: ubuntu-latest
    env:
      REVIEWDOG_GITHUB_API_TOKEN: ${{ github.token }}
    steps:
      - name: Determin reporter type
        uses: haya14busa/action-cond@v1
        id: reporter
        with:
          cond: ${{ github.event.pull_request.draft }}
          if_true: "github-pr-check"
          if_false: "github-pr-review"

      - name: Determine Checkout Depth
        uses: haya14busa/action-cond@v1
        id: fetch-depth
        with:
          cond: ${{ github.actor != 'dependabot[bot]' }}
          if_true: "0"
          if_false: "1"

      - uses: actions/checkout@v6
        with:
          ref: ${{ github.event.pull_request.head.sha }}
          fetch-depth: ${{ steps.fetch-depth.outputs.value }}

      - name: Setup node and install deps
        uses: ./.github/workflows/actions/node-setup
        with:
          node-version: ${{ inputs.NODE_VERSION }}

      - uses: reviewdog/action-setup@v1.5.0

      - name: Delete outdated ReviewDog comments
        uses: Ardiannn08/resolve-outdated-comment@v1.3
        with:
          token: ${{ github.token }}
          filter-user: "reviewdog"

      - name: Lint source files
        uses: mongolyy/reviewdog-action-biome@v2
        with:
          github_token: ${{ github.token }}
          reporter: ${{ steps.reporter.outputs.value }}
          fail_level: error

