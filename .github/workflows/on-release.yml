name: ðŸš€ On release

on:
  release:
    types:
      - published

jobs:
  extract-package:
    runs-on: ubuntu-latest
    outputs:
        appName: ${{ steps.extract.outputs.app-name }}
        appPath: ${{ steps.extract.outputs.app-path }}
    steps:
      - uses: actions/checkout@v6
        with:
          fetch-depth: 0
      
      - name: Extract package name and path
        id: extract
        uses: ./.github/workflows/actions/extract-package-info
        

  build:
    needs: extract-package
    secrets: inherit
    uses: ./.github/workflows/build.yml
    permissions:
      contents: read
      id-token: write
      issues: write
      pull-requests: write
    with:
        app-name: ${{ needs.extract-package.outputs.appName }}
        work-dir: ${{ needs.extract-package.outputs.appPath }}
        environment: '["ci"]' # if needed add additinal environments '["ci", "fqa", "fprd", "tr"]'
        release: true # this will ensure that the app is packed with the version from package.json and not as a snapshot